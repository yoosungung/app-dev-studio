<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
 설문_공통문항 응답 Mapper
 -->
<mapper namespace="kr.ac.jj.survey.domain.main.mapper.survey.cmmnrspns.TbSurveyCmmnRspnsMapper">

    <!-- 공통 응답 ID 조회 - 설문 응답 ID(SURVEY_ID)로 -->
    <select id="selectCmmnRspnsIdBySurveyId" resultType="java.lang.String">
        <![CDATA[
            SELECT TSCR.CMMN_RSPNS_ID
            FROM   TB_SURVEY_CMMN_RSPNS TSCR
            WHERE  TSCR.SURVEY_ID = #{surveyId}
        ]]>
    </select>

    <!-- 공통 응답 ID 조회 - 최종 응답 차수(RSPNS_ODR)로 -->
    <select id="selectCmmnRspnsIdByMaxRspnsOdr" resultType="java.lang.String">
        <![CDATA[
            SELECT TSCR.CMMN_RSPNS_ID
            FROM   TB_SURVEY_CMMN_RSPNS TSCR
            WHERE  TSCR.PERSON_ID = #{personId}
            AND    TSCR.RSPNS_ODR = (
                        SELECT MAX(TSCR2.RSPNS_ODR)
                        FROM   TB_SURVEY_CMMN_RSPNS TSCR2
                        WHERE  TSCR2.PERSON_ID = TSCR.PERSON_ID
                   )
        ]]>
    </select>

</mapper>
