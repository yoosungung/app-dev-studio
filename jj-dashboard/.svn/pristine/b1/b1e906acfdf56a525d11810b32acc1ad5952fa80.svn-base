function ScoreViewService(vue) {
    this.drawGraph = {};

    this.drawGraph["yearScoreGraph"] = function(search) {
        if (search.startStdYy !== "" && search.endStdYy !== "" &&
                search.startStdYy > search.endStdYy) {
            var copy = copyObject(search);
            search.startStdYy = copy.endStdYy;
            search.endStdYy = copy.startStdYy;
        }

        CommonUtil.axios()
        .post("readScoreData", search)
        .then(function(response) {
            CommonUtil.axios()
            .post("readPercentage", search)
            .then(function(percentResponse) {
                var percentData = percentResponse.data;
                var scoreA = [];
                var scoreB = [];
                var scoreC = [];
                var scoreD = [];
                var scoreF = [];
                for(var i=0; i<percentData.length; i++) {
                    scoreA.push(Math.round((percentData[i].scoreA / percentData[i].total) * 100));
                    scoreB.push(Math.round((percentData[i].scoreB / percentData[i].total) * 100));
                    scoreC.push(Math.round((percentData[i].scoreC / percentData[i].total) * 100));
                    scoreD.push(Math.round((percentData[i].scoreD / percentData[i].total) * 100));
                    scoreF.push(Math.round((percentData[i].scoreF / percentData[i].total) * 100));
                }
                var data = response.data;
                var xAxis = [];
                var hakgi1 = [];
                var hakgi2 = [];
                var numHakgi1 = [];
                var numHakgi2 = [];
                var percent = [];

                for(var i=0; i<data.length; i++) {
                    if (i%2 == 0) {
                        xAxis.push(data[i].stdYy);
                    }
                    if (data[i].sutrHakgi == 1) {
                        hakgi1.push(data[i].sutrPyongAve);
                        numHakgi1.push(data[i].cnt);
                    }
                    if (data[i].sutrHakgi == 2) {
                        hakgi2.push(data[i].sutrPyongAve);
                        numHakgi2.push(data[i].cnt);
                    }
                }

                var myChart = echarts.init(document.getElementById('yearScoreGraph'), 'macarons');
                var option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    legend: {
                        data: ['1학기', '2학기', 'A', 'B', 'C', 'D', 'F']
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: [
                        {
                            type: 'category',
                            data: xAxis
                        }
                    ],
                    yAxis: [
                        {
                            max: 3.5,
                            min: 2.5,
                            type: 'value'
                        },
                        {
                            max: 50,
                            min: 0,
                            type: 'value',
                            axisLabel: {
                                formatter: '{value}%'
                            }
                        }
                    ],
                    series: [{
                            name: '1학기',
                            type: 'bar',
                            data: hakgi1
                        },
                        {
                            name: '2학기',
                            type: 'bar',
                            data: hakgi2
                        },
                        {
                            name: '1학기학생수',
                            type: 'scatter',
                            data: numHakgi1
                        },
                        {
                            name: '2학기학생수',
                            type: 'scatter',
                            data: numHakgi2
                        },
                        {
                            name: 'A',
                            type: 'line',
                            yAxisIndex: 1,
                            data: scoreA
                        },
                        {
                            name: 'B',
                            type: 'line',
                            yAxisIndex: 1,
                            data: scoreB
                        },
                        {
                            name: 'C',
                            type: 'line',
                            yAxisIndex: 1,
                            data: scoreC
                        },
                        {
                            name: 'D',
                            type: 'line',
                            yAxisIndex: 1,
                            data: scoreD
                        },
                        {
                            name: 'F',
                            type: 'line',
                            yAxisIndex: 1,
                            data: scoreF
                        }
                    ]
                };
                myChart.setOption(option);
                $(window).on("resize", function() {
                    myChart.resize();
                });
            })
            ["catch"](function(error) {
               CommonUtil.showAxiosError(error);
            });
        })
        ["catch"](function(error) {
            CommonUtil.showAxiosError(error);
        });
    }
    this.drawGraph["yearGraph"] = function(search) {
        if (search.startStdYy !== "" && search.endStdYy !== "" &&
                search.startStdYy > search.endStdYy) {
            var copy = copyObject(search);
            search.startStdYy = copy.endStdYy;
            search.endStdYy = copy.startStdYy;
        }

        CommonUtil.axios()
        .post("readTotalYearScoreData", search)
        .then(function(totalResponse) {
            CommonUtil.axios()
            .post("readYearScoreData", search)
            .then(function(response) {
                var data = response.data;
                var yAxis = [];
                var year = [];
                var numYear = [];

                var totalData = totalResponse.data;
                var totalyAxis = [];
                var totalYear = [];
                var totalNumYear = [];

                var dataName = [];

                for(var i=0; i<data.length; i++) {
                    yAxis.push(data[i].sutrYear + "학년");
                    dataName.push(data[i].sutrYear + "학년");
                    year.push(data[i].sutrPyongAve);
                    numYear.push(data[i].cnt);
                    totalYear.push(totalData[i].sutrPyongAve);
                    totalNumYear.push(totalData[i].cnt);
                }

                var myChart = echarts.init(document.getElementById('yearGraph'), 'macarons');
                var option = {
                    title: {
                        text: search.startStdYy + ' 학년 별 취득학점',
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    legend: {
                        data: ['학년', '전체']
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'value',
                        max: 4.5
                    },
                    yAxis: {
                        type: 'category',
                        data: yAxis
                    },
                    series: [
                        {
                            name: '학년',
                            type: 'line',
                            data: year
                        },
                        {
                            name: '전체',
                            type: 'bar',
                            barMaxWidth: 100,
                            data: totalYear
                        },
                        {
                            name: '학생수',
                            type: 'line',
                            data: numYear
                        },
                        {
                            name: '전체 학생수',
                            type: 'line',
                            data: totalNumYear
                        }
                    ]
                };
                myChart.setOption(option);

                $(window).on("resize", function() {
                    myChart.resize();
                });
            })
            ["catch"](function(error) {
                CommonUtil.showAxiosError(error);
            });
        })
        ["catch"](function(error) {
            CommonUtil.showAxiosError(error);
        });
    }

}
function copyObject(obj){
    if (obj === null || typeof obj !== 'object') {
        return obj;
    }

    const copiedObject = obj.constructor();

    for (let key in obj) {
        if (obj.hasOwnProperty(key)) {
            copiedObject[key] = copyObject(obj[key]);
        }

    }
    return copiedObject;
}

